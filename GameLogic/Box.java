package GameLogic;

import Utility.FunctionLogger;

//
//
//  Generated by StarUML(tm) Java Add-In
//
//  @ Project : 6projlab
//  @ File Name : Box.java
//  @ Date : 2018.03.17.
//  @ Author : Gyöngyösi Péter
//
//




public class Box extends Thing implements Moveable{
	
	
	public void Destroy() {
		FunctionLogger.logFunctionCalled(toString(), "Destroy()");
		GetField().Remove();
		GetField().GetWarehouse().RemoveBox(this);
		FunctionLogger.logFunctionReturnVoid();
	}
	
	public boolean Move(Direction dir) {
		FunctionLogger.logFunctionCalled(toString(), "Move(Direction dir)");
		boolean canMove = GetField().GetNeighbor(dir).HitBy(dir, this);
		if(canMove) {
			GetField().Remove();
			GetField().GetNeighbor(dir).Add(this);
			return FunctionLogger.logFunctionReturn(true);
		}
		return FunctionLogger.logFunctionReturn(false);
	}
	
	@Override
	public boolean HitBy(Direction dir, Box b) {
		FunctionLogger.logFunctionCalled(toString(), "HitBy(Direction dir, Box b)");
		boolean stucked = isStucked();
		if(stucked) {
			b.CheckStucked(dir);			
			return FunctionLogger.logFunctionReturn(false);
		}
		else {
			return FunctionLogger.logFunctionReturn(Move(dir));
		}
	}
	
	@Override
	public boolean HitBy(Direction dir, Worker w) {
		FunctionLogger.logFunctionCalled(toString(), "HitBy(Direction dir, Worker w)");
		boolean stucked = isStucked();
		if(stucked) { 
			return FunctionLogger.logFunctionReturn(false);
		}
		else {
			return FunctionLogger.logFunctionReturn(Move(dir));
		}
	}
	
	public void CheckStucked(Direction dir) {
		FunctionLogger.logFunctionCalled(toString(), "CheckStucked(Direction dir)");
		if(dir == Direction.Left || dir == Direction.Right)
		{			
			boolean stuckedUp  =  true;
			Field upNeighbor = GetField().GetNeighbor(Direction.Up);
			if(upNeighbor != null)
			{
				if(upNeighbor.GetThing() != null)
				{
					stuckedUp = upNeighbor.GetThing().isStucked();
				}
			}
			
			boolean stuckedDown  =  true;
			Field downNeighbor = GetField().GetNeighbor(Direction.Down);
			if(downNeighbor != null)
			{
				if(downNeighbor.GetThing() != null)
				{
					stuckedUp = downNeighbor.GetThing().isStucked();
				}
			}
			
			if(stuckedUp || stuckedDown)
				SetStucked(true);
		}
		else // if(dir == Direction.Up || dir == Direction.Down)
		{
			boolean stuckedLeft  =  true;
			Field leftNeighbor = GetField().GetNeighbor(Direction.Left);
			if(leftNeighbor != null)
			{
				if(leftNeighbor.GetThing() != null)
				{
					stuckedLeft = leftNeighbor.GetThing().isStucked();
				}
			}
			
			boolean stuckedRight  =  true;
			Field rightNeighbor = GetField().GetNeighbor(Direction.Right);
			if(rightNeighbor != null)
			{
				if(rightNeighbor.GetThing() != null)
				{
					stuckedRight = rightNeighbor.GetThing().isStucked();
				}
			}
			
			
			if(stuckedLeft || stuckedRight)
				SetStucked(true);
		}
		FunctionLogger.logFunctionReturnVoid();
	}
	
}
